/*!
 * FilePondPluginFilePoster 2.3.0
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

const e={type:"spring",stiffness:.5,damping:.45,mass:10},t=(e,t,r=1,i=(e=>-.5*(Math.cos(Math.PI*e)-1)),a=10,o=0)=>{const n=1-o,l=t.join(",");for(let t=0;t<=a;t++){const s=t/a,c=o+n*s;e.addColorStop(c,`rgba(${l}, ${i(s)*r})`)}},r=e=>{const t=Math.min(10/e.width,10/e.height),r=document.createElement("canvas"),a=r.getContext("2d"),o=r.width=Math.ceil(e.width*t),n=r.height=Math.ceil(e.height*t);a.drawImage(e,0,0,o,n);let l=null;try{l=a.getImageData(0,0,o,n).data}catch(e){return null}const s=l.length;let c=0,d=0,E=0,_=0;for(;_<s;_+=4)c+=l[_]*l[_],d+=l[_+1]*l[_+1],E+=l[_+2]*l[_+2];return{r:c=i(c,s),g:d=i(d,s),b:E=i(E,s)}},i=(e,t)=>Math.floor(Math.sqrt(e/(t/4))),a=(e,r,i,a,o)=>{e.width=r,e.height=i;const n=e.getContext("2d"),l=.5*r,s=n.createRadialGradient(l,i+110,i-100,l,i+110,i+100);t(s,a,o,void 0,8,.4),n.save(),n.translate(.5*-r,0),n.scale(2,1),n.fillStyle=s,n.fillRect(0,0,r,i),n.restore()},o="undefined"!=typeof navigator,n=o&&document.createElement("canvas"),l=o&&document.createElement("canvas"),s=o&&document.createElement("canvas");o&&(a(n,500,200,[40,40,40],.85),a(l,500,200,[196,78,71],1),a(s,500,200,[54,151,99],1));const c=t=>{const i=(e=>e.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:t})=>{((e,t)=>{t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0)})(t.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}))(t),a=({root:e})=>{e.ref.overlayShadow.opacity=1,e.ref.overlayError.opacity=0,e.ref.overlaySuccess.opacity=0},o=({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlayError.opacity=1};return t.utils.createView({name:"file-poster-wrapper",create:({root:r,props:a})=>{const o=(t=>t.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:t})=>{const{id:r}=t,i=e.query("GET_ITEM",{id:t.id});if(!i)return;const a=i.getMetadata("poster");e.ref.image.src=a,e.dispatch("DID_FILE_POSTER_DRAW",{id:r})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:e,scaleY:e,opacity:{type:"tween",duration:750}}}}))(t);r.ref.image=r.appendChildView(r.createChildView(o,{id:a.id,scaleX:1.25,scaleY:1.25,opacity:0})),r.ref.overlayShadow=r.appendChildView(r.createChildView(i,{template:n,opacity:0})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(i,{template:s,opacity:0})),r.ref.overlayError=r.appendChildView(r.createChildView(i,{template:l,opacity:0}))},write:t.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e})=>{e.ref.overlayShadow.opacity=1},DID_FILE_POSTER_DRAW:({root:e})=>{const{image:t}=e.ref;t.scaleX=1,t.scaleY=1,t.opacity=1},DID_FILE_POSTER_CONTAINER_CREATE:({root:e,props:t})=>{const{id:i}=t,a=e.query("GET_ITEM",i);if(!a)return;const o=a.getMetadata("poster"),n=t=>{const o=e.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?r(t):null;a.setMetadata("color",o,!0),e.dispatch("DID_FILE_POSTER_LOAD",{id:i,data:t})};((e,t)=>{let r=new Image;r.onload=(()=>{const e=r.naturalWidth,i=r.naturalHeight;r=null,t(e,i)}),r.src=e})(o,(t,r)=>{e.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:i,width:t,height:r}),((e,t)=>new Promise((r,i)=>{const a=new Image;"string"==typeof crossOrigin&&(a.crossOrigin=t),a.onload=(()=>{r(a)}),a.onerror=(e=>{i(e)}),a.src=e}))(o,e.query("GET_FILE_POSTER_CROSS_ORIGIN_ATTRIBUTE_VALUE")).then(n)})},DID_THROW_ITEM_LOAD_ERROR:o,DID_THROW_ITEM_PROCESSING_ERROR:o,DID_THROW_ITEM_INVALID:o,DID_COMPLETE_ITEM_PROCESSING:({root:e})=>{e.ref.overlayShadow.opacity=.25,e.ref.overlaySuccess.opacity=1},DID_START_ITEM_PROCESSING:a,DID_REVERT_ITEM_PROCESSING:a})})},d=e=>{const{addFilter:t,utils:r}=e,{Type:i,createRoute:a}=r,o=c(e);return t("CREATE_VIEW",e=>{const{is:t,view:r,query:i}=e;if(!t("file")||!i("GET_ALLOW_FILE_POSTER"))return;const n=({root:e})=>{let t=e.query("GET_FILE_POSTER_HEIGHT");if(t)return t;const r=e.query("GET_FILE_POSTER_MIN_HEIGHT"),i=e.query("GET_FILE_POSTER_MAX_HEIGHT");if(r&&e.ref.imageHeight<r)return r;let a=e.rect.element.width*(e.ref.imageHeight/e.ref.imageWidth);return r&&a<r?r:i&&a>i?i:a};r.registerWriter(a({DID_LOAD_ITEM:({root:e,props:t})=>{const{id:a}=t,n=i("GET_ITEM",a);n&&n.getMetadata("poster")&&!n.archived&&i("GET_FILE_POSTER_FILTER_ITEM")(n)&&(e.ref.filePoster=r.appendChildView(r.createChildView(o,{id:a})),e.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:a}))},DID_FILE_POSTER_CALCULATE_SIZE:({root:e,action:t})=>{e.ref.filePoster&&(e.ref.imageWidth=t.width,e.ref.imageHeight=t.height,e.ref.shouldUpdatePanelHeight=!0,e.dispatch("KICK"))}},({root:e,props:t})=>{e.ref.filePoster&&(e.rect.element.hidden||e.ref.shouldUpdatePanelHeight&&(e.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:t.id,height:n({root:e})}),e.ref.shouldUpdatePanelHeight=!1))}))}),{options:{allowFilePoster:[!0,i.BOOLEAN],filePosterHeight:[null,i.INT],filePosterMinHeight:[null,i.INT],filePosterMaxHeight:[null,i.INT],filePosterFilterItem:[()=>!0,i.FUNCTION],filePosterCalculateAverageImageColor:[!1,i.BOOLEAN],filePosterCrossOriginAttributeValue:["Anonymous",i.STRING]}}};"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:d}));export default d;
